{
  "title": "TurkiyeAPI Adres YÃ¶netimi Sistemi - Ã‡alÄ±ÅŸma MantÄ±ÄŸÄ±",
  "date": "2025-11-12",
  "version": "1.0.0",
  "status": "production-ready",
  "context7_compliance": true,
  "system": {
    "name": "Adres YÃ¶netimi",
    "api": "TurkiyeAPI (https://api.turkiyeapi.dev)",
    "components": [
      "Ä°l (Province)",
      "Ä°lÃ§e (District)",
      "Mahalle (Neighborhood)"
    ]
  },
  "architecture": {
    "two_stage_process": {
      "stage_1_fetch": {
        "description": "TurkiyeAPI'den veri Ã§ekme (veritabanÄ±na kaydetmeden)",
        "purpose": "KullanÄ±cÄ±ya Ã¶nizleme gÃ¶sterme",
        "features": [
          "UI'da gÃ¶sterim",
          "TurkiyeAPI badge",
          "Sync edilmemiÅŸ etiketi",
          "Sayfa yenilendiÄŸinde kaybolur"
        ]
      },
      "stage_2_sync": {
        "description": "Ã‡ekilen verileri veritabanÄ±na kaydetme",
        "purpose": "KalÄ±cÄ± veri saklama",
        "features": [
          "Transaction gÃ¼venliÄŸi",
          "Duplicate kontrolÃ¼",
          "ID eÅŸleÅŸtirmesi",
          "KalÄ±cÄ± kayÄ±t"
        ]
      }
    }
  },
  "critical_logic": {
    "district_id_mapping": {
      "problem": "TurkiyeAPI ID'si ile DB ID'si farklÄ± olabilir",
      "solution": "Ä°ki aÅŸamalÄ± eÅŸleÅŸtirme",
      "steps": [
        "1. DB'de ilÃ§e var mÄ± kontrol et",
        "2. Varsa: Ä°lÃ§e adÄ±na gÃ¶re TurkiyeAPI ID'sini bul",
        "3. Yoksa: TurkiyeAPI ID'sine gÃ¶re DB ID'sini bul",
        "4. TurkiyeAPI ID'si ile mahalleleri Ã§ek",
        "5. DB ID'si ile mahalleleri kaydet"
      ],
      "example": {
        "bodrum": {
          "turkiyeapi_id": 1234,
          "db_id": 1,
          "mapping_method": "Ä°lÃ§e adÄ±na gÃ¶re eÅŸleÅŸtirme"
        }
      }
    }
  },
  "endpoints": {
    "fetch": {
      "url": "/admin/adres-yonetimi/fetch-from-turkiyeapi",
      "method": "POST",
      "parameters": {
        "province_id": "Ä°l ID (opsiyonel)",
        "district_id": "Ä°lÃ§e ID (opsiyonel)",
        "type": "auto|districts|neighborhoods"
      },
      "response": {
        "success": true,
        "data": {
          "districts": [],
          "neighborhoods": [],
          "towns": [],
          "villages": []
        },
        "counts": {
          "districts": 0,
          "neighborhoods": 0,
          "total": 0
        }
      }
    },
    "sync": {
      "url": "/admin/adres-yonetimi/sync-from-turkiyeapi",
      "method": "POST",
      "parameters": {
        "type": "all|provinces|districts|neighborhoods",
        "province_id": "Ä°l ID (opsiyonel)",
        "district_id": "Ä°lÃ§e ID (opsiyonel)"
      },
      "response": {
        "success": true,
        "results": {
          "provinces": 0,
          "districts": 0,
          "neighborhoods": 0
        }
      }
    }
  },
  "files": {
    "backend": {
      "controller": "app/Http/Controllers/Admin/AdresYonetimiController.php",
      "methods": [
        "getIller() - Otomatik il yÃ¼kleme",
        "fetchFromTurkiyeAPI() - SeÃ§imli veri Ã§ekme",
        "syncFromTurkiyeAPI() - Veri senkronizasyonu"
      ]
    },
    "frontend": {
      "view": "resources/views/admin/adres-yonetimi/index.blade.php",
      "functions": [
        "fetchFromTurkiyeAPI() - Frontend fetch",
        "syncFromTurkiyeAPI() - Frontend sync",
        "selectIlce() - Ä°lÃ§e seÃ§imi"
      ]
    },
    "service": {
      "class": "app/Services/TurkiyeAPIService.php",
      "methods": [
        "getProvinces() - Ä°lleri Ã§ek",
        "getDistricts() - Ä°lÃ§eleri Ã§ek",
        "getNeighborhoods() - Mahalleleri Ã§ek"
      ]
    }
  },
  "workflow": {
    "scenario_1_new_province": {
      "steps": [
        "1. Ä°l dropdown'Ä±ndan seÃ§",
        "2. 'TurkiyeAPI'den Ã‡ek' â†’ Ä°lÃ§eler gelir",
        "3. 'SeÃ§ime GÃ¶re Sync Et' â†’ Ä°lÃ§eler DB'ye kaydedilir"
      ]
    },
    "scenario_2_new_neighborhoods": {
      "steps": [
        "1. Ä°l: MuÄŸla seÃ§",
        "2. Ä°lÃ§e: Bodrum seÃ§",
        "3. 'TurkiyeAPI'den Ã‡ek' â†’ 574 mahalle gelir",
        "4. 'SeÃ§ime GÃ¶re Sync Et' â†’ Mahalleler DB'ye kaydedilir"
      ]
    },
    "scenario_3_specific_district": {
      "steps": [
        "1. Ä°l: MuÄŸla seÃ§",
        "2. Ä°lÃ§e: Bodrum seÃ§",
        "3. 'TurkiyeAPI'den Ã‡ek' â†’ Sadece Bodrum mahalleleri",
        "4. 'SeÃ§ime GÃ¶re Sync Et' â†’ Sadece Bodrum mahalleleri kaydedilir"
      ]
    }
  },
  "ui_features": {
    "fetch_indicator": {
      "description": "Ã‡ekilen veriler bilgi kutusu",
      "shows": [
        "Ä°lÃ§e sayÄ±sÄ±",
        "Mahalle sayÄ±sÄ±",
        "Belde sayÄ±sÄ±",
        "KÃ¶y sayÄ±sÄ±"
      ],
      "badge": "TurkiyeAPI",
      "status": "Sync edilmemiÅŸ"
    },
    "sync_button": {
      "disabled_condition": "SeÃ§im yapÄ±lmadÄ±ÄŸÄ±nda disabled",
      "warning": "TÃ¼m verileri sync etmek zaman aÅŸÄ±mÄ±na neden olabilir"
    }
  },
  "performance": {
    "fetch": {
      "speed": "HÄ±zlÄ± (sadece API Ã§aÄŸrÄ±sÄ±)",
      "database": "Yazma yok",
      "ui": "GÃ¶sterim"
    },
    "sync": {
      "speed": "YavaÅŸ olabilir (DB yazma)",
      "transaction": "KullanÄ±lÄ±r",
      "batch": "Insert yapÄ±labilir"
    }
  },
  "debugging": {
    "frontend_logs": [
      "ğŸ” syncFromTurkiyeAPI Ã§aÄŸrÄ±ldÄ±",
      "ğŸ” fetchSelectedIlId",
      "ğŸ” fetchSelectedIlceId",
      "ğŸ” Belirlenen provinceId",
      "ğŸ” Belirlenen districtId",
      "ğŸ” Sync Response",
      "ğŸ” Sync Results"
    ],
    "backend_logs": [
      "TurkiyeAPI: Ä°lÃ§e eÅŸleÅŸtirildi",
      "TurkiyeAPI: Ä°lÃ§e ID X iÃ§in Y mahalle Ã§ekildi",
      "TurkiyeAPI: Ä°lÃ§e bulunamadÄ±"
    ]
  },
  "context7_compliance": {
    "database_fields": {
      "il_adi": "NOT sehir_adi",
      "ilce_adi": "NOT district_name",
      "mahalle_adi": "NOT neighborhood_name",
      "il_id": "NOT sehir_id",
      "ilce_id": "NOT district_id"
    },
    "ui_components": {
      "css": "Tailwind CSS utility classes",
      "js": "Vanilla JS (NO heavy libraries)",
      "framework": "Alpine.js reactive components"
    }
  },
  "important_notes": [
    "ID eÅŸleÅŸtirmesi kritik - TurkiyeAPI ID â‰  DB ID olabilir",
    "Sync butonu sadece seÃ§im yapÄ±ldÄ±ÄŸÄ±nda aktif",
    "TÃ¼m verileri sync etmek zaman aÅŸÄ±mÄ±na neden olabilir",
    "Ä°lÃ§e adÄ±na gÃ¶re eÅŸleÅŸtirme yapÄ±lÄ±r",
    "TurkiyeAPI ID'si ile Ã§ekilir, DB ID'si ile kaydedilir"
  ]
}

