{
  "rule_id": "CONTEXT7-STATUS-FIELD-001",
  "title": "Status Field Zorunlu StandardÄ±",
  "category": "database",
  "severity": "CRITICAL",
  "enabled": true,
  "created_at": "2025-10-24T17:00:00Z",
  "updated_at": "2025-11-06T00:00:00Z",

  "description": "TÃ¼m tablolarda status field TINYINT(1) boolean olmalÄ±dÄ±r. 'enabled', 'is_active', 'aktif' field isimleri YASAK! SADECE 'status' kullanÄ±lmalÄ±. VARCHAR, ENUM veya TÃ¼rkÃ§e deÄŸerler YASAK.",

  "field_naming_standard": {
    "required": "status",
    "forbidden": ["enabled", "is_active", "aktif", "durum", "active"],
    "reason": "Context7 Consistency: TÃ¼m tablolarda aynÄ± field ismi kullanÄ±lmalÄ±",
    "severity": "CRITICAL"
  },

  "context7_compliance": {
    "standard": "Status fields MUST be TINYINT(1)",
    "rationale": "Boolean status provides consistent queries, validation, and API responses across the entire system.",
    "compliance_level": "MANDATORY"
  },

  "forbidden_patterns": {
    "migrations": [
      {
        "pattern": "\\$table->string\\('status'\\)",
        "message": "âŒ Status field ASLA string olamaz! Kullan: $table->tinyInteger('status')->default(1)",
        "severity": "CRITICAL"
      },
      {
        "pattern": "\\$table->varchar\\('status'",
        "message": "âŒ Status field ASLA varchar olamaz! Kullan: $table->tinyInteger('status')->default(1)",
        "severity": "CRITICAL"
      },
      {
        "pattern": "\\$table->enum\\('status'",
        "message": "âŒ Status field ASLA enum olamaz! Kullan: $table->tinyInteger('status')->default(1)",
        "severity": "CRITICAL"
      },
      {
        "pattern": "->default\\('Aktif'\\)",
        "message": "âŒ Status default ASLA TÃ¼rkÃ§e olamaz! Kullan: ->default(1)",
        "severity": "CRITICAL"
      },
      {
        "pattern": "->default\\('Pasif'\\)",
        "message": "âŒ Status default ASLA TÃ¼rkÃ§e olamaz! Kullan: ->default(0)",
        "severity": "CRITICAL"
      },
      {
        "pattern": "->default\\('active'\\)",
        "message": "âŒ Status default string olamaz! Kullan: ->default(1)",
        "severity": "CRITICAL"
      },
      {
        "pattern": "->default\\('inactive'\\)",
        "message": "âŒ Status default string olamaz! Kullan: ->default(0)",
        "severity": "CRITICAL"
      }
    ],

    "controllers": [
      {
        "pattern": "where\\('status',\\s*'Aktif'\\)",
        "message": "âŒ Query'de TÃ¼rkÃ§e status kullanma! Kullan: where('status', true)",
        "severity": "HIGH"
      },
      {
        "pattern": "where\\('status',\\s*'Pasif'\\)",
        "message": "âŒ Query'de TÃ¼rkÃ§e status kullanma! Kullan: where('status', false)",
        "severity": "HIGH"
      },
      {
        "pattern": "where\\('status',\\s*'active'\\)",
        "message": "âŒ Query'de string status kullanma! Kullan: where('status', true)",
        "severity": "HIGH"
      },
      {
        "pattern": "where\\('status',\\s*'inactive'\\)",
        "message": "âŒ Query'de string status kullanma! Kullan: where('status', false)",
        "severity": "HIGH"
      }
    ],

    "models": [
      {
        "pattern": "protected \\$fillable.*status.*(?!.*protected \\$casts.*status.*boolean)",
        "message": "âš ï¸ Model'de status field var AMA cast eksik! Ekle: 'status' => 'boolean'",
        "severity": "MEDIUM"
      },
      {
        "pattern": "'enabled'|\"enabled\"|'is_active'|\"is_active\"",
        "message": "âŒ Model'de 'enabled' veya 'is_active' field YASAK! SADECE 'status' kullanÄ±lmalÄ±",
        "severity": "CRITICAL"
      }
    ],

    "validation": [
      {
        "pattern": "'status'\\s*=>\\s*'in:Aktif,Pasif'",
        "message": "âŒ Validation'da TÃ¼rkÃ§e status kullanma! Kullan: 'status' => 'boolean'",
        "severity": "HIGH"
      },
      {
        "pattern": "'status'\\s*=>\\s*'in:active,inactive'",
        "message": "âŒ Validation'da string status kullanma! Kullan: 'status' => 'boolean'",
        "severity": "HIGH"
      }
    ]
  },

  "required_patterns": {
    "migrations": {
      "correct": "$table->tinyInteger('status')->default(1)->comment('0=inactive, 1=active (Context7 boolean)');",
      "examples": [
        "// âœ… DOÄžRU:",
        "$table->tinyInteger('status')->default(1);",
        "$table->tinyInteger('status')->default(0);",
        "$table->tinyInteger('status')->default(1)->comment('0=inactive, 1=active');",
        "",
        "// âŒ YANLIÅž:",
        "$table->string('status')->default('Aktif');",
        "$table->varchar('status', 255);",
        "$table->enum('status', ['Aktif', 'Pasif']);",
        "$table->enum('status', ['active', 'inactive']);"
      ]
    },

    "models": {
      "correct": "protected $casts = [\n    'status' => 'boolean',\n];",
      "examples": [
        "// âœ… DOÄžRU:",
        "protected $casts = [",
        "    'status' => 'boolean',",
        "];",
        "",
        "// âŒ YANLIÅž:",
        "// Cast yok!",
        "protected $casts = [",
        "    'status' => 'string',  // âŒ",
        "];"
      ]
    },

    "controllers": {
      "correct": "where('status', true) // or where('status', false)",
      "examples": [
        "// âœ… DOÄžRU:",
        "Model::where('status', true)->get();",
        "Model::where('status', false)->get();",
        "$model->status = true;",
        "$model->status = false;",
        "",
        "// âŒ YANLIÅž:",
        "Model::where('status', 'Aktif')->get();  // âŒ Turkish",
        "Model::where('status', 'active')->get(); // âŒ String",
        "$model->status = 'Aktif';                // âŒ Turkish"
      ]
    },

    "validation": {
      "correct": "'status' => 'boolean'",
      "examples": [
        "// âœ… DOÄžRU:",
        "'status' => 'boolean',",
        "'status' => 'required|boolean',",
        "'status' => 'nullable|boolean',",
        "",
        "// âŒ YANLIÅž:",
        "'status' => 'in:Aktif,Pasif',        // âŒ Turkish",
        "'status' => 'in:active,inactive',    // âŒ String"
      ]
    }
  },

  "exceptions": {
    "complex_status_fields": [
      {
        "table": "blog_posts",
        "field": "status",
        "reason": "Multi-state status (draft, published, scheduled, archived)",
        "allowed_type": "VARCHAR or ENUM",
        "allowed_values": ["draft", "published", "scheduled", "archived"],
        "note": "NOT a simple active/inactive boolean - complex workflow status"
      },
      {
        "table": "blog_comments",
        "field": "status",
        "reason": "Multi-state status (pending, approved, spam, deleted)",
        "allowed_type": "VARCHAR or ENUM",
        "allowed_values": ["pending", "approved", "spam", "deleted"],
        "note": "NOT a simple active/inactive boolean - moderation workflow"
      },
      {
        "table": "yazlik_rezervasyonlar",
        "field": "status",
        "reason": "Multi-state status (beklemede, onaylandi, iptal, tamamlandi)",
        "allowed_type": "ENUM",
        "allowed_values": ["beklemede", "onaylandi", "iptal", "tamamlandi"],
        "note": "NOT a simple active/inactive boolean - reservation workflow"
      },
      {
        "table": "gorevler",
        "field": "status",
        "reason": "Multi-state status (Beklemede, Devam Ediyor, Tamamlandi, Iptal)",
        "allowed_type": "VARCHAR or ENUM",
        "allowed_values": ["Beklemede", "Devam Ediyor", "Tamamlandi", "Iptal"],
        "note": "NOT a simple active/inactive boolean - task workflow"
      },
      {
        "table": "eslesmeler",
        "field": "status",
        "reason": "Multi-state status (beklemede, eslesti, iptal)",
        "allowed_type": "VARCHAR or ENUM",
        "allowed_values": ["beklemede", "eslesti", "iptal"],
        "note": "NOT a simple active/inactive boolean - matching workflow"
      }
    ],

    "how_to_decide": {
      "use_boolean_if": [
        "Status sadece 2 state'e sahip (active/inactive, enabled/disabled, on/off)",
        "Status bir toggle switch ile temsil edilebilir",
        "Status bir workflow'un parÃ§asÄ± deÄŸil",
        "Status sadece kayÄ±dÄ±n 'gÃ¶rÃ¼nÃ¼r/gizli' olduÄŸunu gÃ¶sterir"
      ],
      "use_enum_varchar_if": [
        "Status 3+ farklÄ± deÄŸere sahip",
        "Status bir workflow'un state'ini temsil ediyor (draft â†’ published â†’ archived)",
        "Status deÄŸerleri anlamlÄ± kelimeler gerektiriyor (not just on/off)",
        "Status deÄŸerleri kullanÄ±cÄ±ya gÃ¶sterilecek (UI'da label olarak)"
      ]
    }
  },

  "automated_checks": {
    "pre_commit_hook": {
      "enabled": true,
      "script": ".git/hooks/pre-commit",
      "checks": [
        "Scan migration files for forbidden status patterns",
        "Scan controller files for Turkish status queries",
        "Scan model files for missing status casting"
      ]
    },

    "ci_pipeline": {
      "enabled": true,
      "checks": [
        "Database schema audit for non-boolean status fields",
        "Code audit for string status queries"
      ]
    }
  },

  "crisis_history": {
    "VIO-2025-01-24-001": {
      "table": "ilan_kategorileri",
      "problem": "status VARCHAR(255) default 'Aktif'",
      "fixed": "2025-10-24",
      "solution": "Migration to TINYINT(1)"
    },
    "VIO-2025-01-24-002": {
      "table": "ilan_kategori_yayin_tipleri",
      "problem": "status VARCHAR(255) default 'Aktif'",
      "fixed": "2025-10-24",
      "solution": "Migration to TINYINT(1)"
    },
    "VIO-2025-10-24-MASTER": {
      "affected_tables": 22,
      "problem": "Sistem-wide status field inconsistency",
      "analysis": "docs/context7/STATUS_FIELD_CRISIS_ANALYSIS.md",
      "solution": "Master migration + prevention system"
    }
  },

  "documentation": [
    "docs/context7/STATUS_FIELD_CRISIS_ANALYSIS.md",
    "stubs/migration.context7-status.stub",
    "yalihan-bekci/rules/status-field-standard.json"
  ],

  "quick_reference": {
    "âœ… ALWAYS USE": "$table->tinyInteger('status')->default(1);",
    "âŒ NEVER USE": [
      "$table->string('status')",
      "$table->enum('status', ['Aktif', 'Pasif'])",
      "->default('Aktif')",
      "where('status', 'Aktif')"
    ],
    "ðŸŽ¯ GOAL": "100% Context7 compliance - All status fields are boolean"
  }
}
