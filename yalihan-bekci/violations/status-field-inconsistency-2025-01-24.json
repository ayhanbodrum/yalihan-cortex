{
  "violation_id": "VIO-2025-01-24-001",
  "type": "database_inconsistency",
  "severity": "high",
  "title": "Status Field Tutarsızlığı - ilan_kategorileri Tablosu",
  "description": "Database'de status field'ı tutarsız değerler içeriyor: 'Aktif' (string) ve '1' (string). Context7'ye göre boolean olmalı.",
  "detected_at": "2025-01-24T00:00:00Z",
  "context7_rule": "Status field MUST be boolean (TINYINT(1) or BOOLEAN type)",
  "affected_table": "ilan_kategorileri",
  "affected_files": [
    "app/Http/Controllers/Admin/IlanController.php",
    "app/Http/Controllers/Admin/IlanKategoriController.php"
  ],
  "issue": {
    "field": "status",
    "expected_type": "BOOLEAN (0/1 or true/false)",
    "found_values": [
      {
        "value": "Aktif",
        "type": "STRING",
        "count": 4,
        "categories": ["Konut", "İşyeri", "Arsa", "Turistik Tesis"]
      },
      {
        "value": "1",
        "type": "STRING",
        "count": 1,
        "categories": ["Projeler"]
      }
    ]
  },
  "impact": {
    "severity": "critical",
    "description": "Query where('status', true) sadece 1 kayıt döndürüyor",
    "affected_features": [
      "Ana kategori listesi",
      "Alt kategori cascade",
      "Kategori filtreleme"
    ],
    "user_experience": "Kullanıcılar sadece 'Projeler' kategorisini görebiliyor, diğer 4 ana kategori görünmüyor"
  },
  "temporary_fix": {
    "type": "whereIn_workaround",
    "code": "whereIn('status', ['Aktif', '1', 1, true])",
    "files_modified": [
      "app/Http/Controllers/Admin/IlanController.php:107",
      "app/Http/Controllers/Admin/IlanKategoriController.php:527"
    ],
    "status": "applied",
    "note": "Bu geçici bir çözüm. Kalıcı çözüm için migration gerekli."
  },
  "permanent_solution": {
    "action": "migration_required",
    "priority": "high",
    "steps": [
      {
        "step": 1,
        "action": "Create migration",
        "command": "php artisan make:migration fix_ilan_kategorileri_status_field_to_boolean"
      },
      {
        "step": 2,
        "action": "Change column type",
        "sql": "ALTER TABLE ilan_kategorileri MODIFY COLUMN status TINYINT(1) NOT NULL DEFAULT 1"
      },
      {
        "step": 3,
        "action": "Normalize data",
        "sql": "UPDATE ilan_kategorileri SET status = 1 WHERE status IN ('Aktif', '1', 'aktif'); UPDATE ilan_kategorileri SET status = 0 WHERE status IN ('Pasif', '0', 'pasif')"
      },
      {
        "step": 4,
        "action": "Revert temporary fix",
        "description": "whereIn() yerine where('status', true) kullanımına geri dön"
      }
    ]
  },
  "prevention": {
    "rules": [
      "Status field ASLA VARCHAR/TEXT olmamalı",
      "Status field DAIMA TINYINT(1) veya BOOLEAN olmalı",
      "Model'de 'status' => 'boolean' cast kullanılmalı",
      "Migration'larda status için $table->boolean('status')->default(true) kullanılmalı"
    ],
    "code_review_checklist": [
      "Status field VARCHAR mı? → REDDET",
      "Status field string değer mi alıyor? → REDDET",
      "Status field cast edilmiş mi? → KONTROL ET"
    ]
  },
  "related_violations": [],
  "fixed": false,
  "fix_date": null,
  "notes": "Bu violation Context7 compliance'ı ciddi şekilde ihlal ediyor. Öncelikli olarak düzeltilmeli."
}

