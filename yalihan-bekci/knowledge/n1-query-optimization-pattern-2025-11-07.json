{
  "title": "N+1 Query Optimization Pattern",
  "date": "2025-11-07",
  "category": "performance",
  "severity": "high",
  "description": "Her kayıt için ayrı database query çalışması durumu. Performans sorunlarına ve database overload'a yol açar.",
  "pattern": {
    "problem": "Loop içinde relationship sorguları",
    "example_bad": "$items = Model::all(); foreach($items as $item) { echo $item->relation->name; } // Her item için 1 query = N+1 query",
    "example_good": "$items = Model::with('relation')->get(); foreach($items as $item) { echo $item->relation->name; } // Sadece 1 query"
  },
  "prevention": {
    "checklist": [
      "Liste sayfalarında with() veya withCount() kullan",
      "Select optimization ile sadece gerekli kolonları çek",
      "Relationship'ler için eager loading kullan",
      "withCount() ile sayı bilgilerini tek query'de al"
    ],
    "optimization_rules": [
      "with(['relation:id,name']) - Sadece gerekli kolonlar",
      "withCount('relation') - Sayı bilgisi için",
      "select(['id', 'name', 'relation_id']) - Select optimization"
    ]
  },
  "fixed_controllers": [
    "EtiketController: withCount('kisiler') eklendi",
    "DashboardController: with(['roles:id,name']) eklendi",
    "DanismanController: with('roles:id,name') eklendi (index ve show)"
  ],
  "impact": {
    "before": "100 kayıt = 101 query, sayfa yükleme 10-30 saniye, database CPU %80-100",
    "after": "100 kayıt = 1 query, sayfa yükleme 1-2 saniye, database CPU %10"
  },
  "performance_gain": "90%+ iyileşme"
}

