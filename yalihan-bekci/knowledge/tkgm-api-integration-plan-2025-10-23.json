{
  "timestamp": "2025-10-24T00:05:00Z",
  "task": "TKGM API Entegrasyonu - AlÄ±m-SatÄ±m YoÄŸunluÄŸu",
  "status": "discovered",
  "priority": "high",
  "category": "api_integration_commercial",

  "source": {
    "article": "https://medium.com/tapu-com-bakÄ±ÅŸ-aÃ§Ä±sÄ±/tapu-ve-kadastro-analiz-verilerinin-kullanÄ±mÄ±-32bd788a5ce9",
    "author": "Umar Igan (Tapu.com)",
    "date": "Jan 30, 2022",
    "github": "https://github.com/umarigan/parcel-analysis"
  },

  "tkgm_api": {
    "base_url": "https://cbsservis.tkgm.gov.tr/megsiswebapi.v3/api",
    "endpoints": {
      "il_liste": {
        "url": "/idariYapi/ilListe",
        "method": "GET",
        "response": {
          "features": [
            {
              "properties": {
                "id": 48,
                "text": "MuÄŸla"
              }
            }
          ]
        }
      },
      "alim_satim_yogunlugu": {
        "url": "/analiz",
        "method": "GET",
        "params": {
          "AnalizTip": 2,
          "Yil": "2017-2024",
          "IlId": "{city_id}"
        },
        "response": [
          {
            "parsel": "123/456",
            "enlem": 37.21667,
            "boylam": 28.36667,
            "sayÄ±": 5,
            "YÄ±l": 2023
          }
        ]
      }
    }
  },

  "value_proposition": {
    "what": "AlÄ±m-satÄ±m yoÄŸunluÄŸu verisi (yÄ±llara gÃ¶re trend)",
    "why": "Bir bÃ¶lgenin ticari aktivitesi â†’ YatÄ±rÄ±m potansiyeli gÃ¶stergesi",
    "how": "TKGM API + TurkiyeAPI = Demografik + Ticari tam skor",
    "example": {
      "location": "Bodrum, YalÄ±kavak",
      "turkiye_api": {
        "population": 198335,
        "density": "305 kiÅŸi/kmÂ²",
        "coastal": true,
        "metropolitan": true,
        "score": 100
      },
      "tkgm_api": {
        "transactions_2023": 324,
        "transactions_2022": 289,
        "trend": "+12%",
        "rank_in_bodrum": 1,
        "hotspot": true
      },
      "combined_score": {
        "demographic": 100,
        "commercial_activity": 95,
        "total": 97.5,
        "interpretation": "â­â­â­ Ultra YÃ¼ksek Potansiyel"
      }
    }
  },

  "use_cases": {
    "use_case_1": {
      "name": "Ä°lan Detay - AlÄ±m-SatÄ±m Hotspot GÃ¶stergesi",
      "description": "Ä°lanÄ±n bulunduÄŸu bÃ¶lgedeki son 3 yÄ±l alÄ±m-satÄ±m trendini gÃ¶ster",
      "display": [
        "2021: 245 iÅŸlem",
        "2022: 289 iÅŸlem (+18%)",
        "2023: 324 iÅŸlem (+12%)",
        "ğŸ“ˆ Trend: ARTAN (Hotspot BÃ¶lge!)"
      ],
      "badge": "ğŸ”¥ Hotspot BÃ¶lge (Son 3 yÄ±lda +32% iÅŸlem artÄ±ÅŸÄ±)",
      "value": "AlÄ±cÄ± bu bÃ¶lgenin popÃ¼ler olduÄŸunu gÃ¶rÃ¼r"
    },

    "use_case_2": {
      "name": "Dashboard - Åehir BazlÄ± Ä°ÅŸlem Analizi",
      "widgets": [
        "Ä°ÅŸlem Trendi Chart (2020-2024)",
        "En YoÄŸun Ä°lÃ§eler (Top 5)",
        "YÄ±llÄ±k BÃ¼yÃ¼me OranÄ± (%)",
        "Hotspot Harita (Leaflet.js)"
      ]
    },

    "use_case_3": {
      "name": "AI Prompt - Trend Vurgulu Ä°Ã§erik",
      "enhancement": "Bu bÃ¶lge son 3 yÄ±lda %32 iÅŸlem artÄ±ÅŸÄ± gÃ¶rdÃ¼, yÃ¼kselen bir bÃ¶lge!",
      "before": "Bodrum YalÄ±kavak'ta villa",
      "after": "Bodrum YalÄ±kavak'ta villa - ğŸ”¥ Son 3 yÄ±lda %32 iÅŸlem artÄ±ÅŸÄ± olan hotspot bÃ¶lge!"
    },

    "use_case_4": {
      "name": "YatÄ±rÄ±m Skoru v2 (Demografik + Ticari)",
      "formula": {
        "demographic_score": "TurkiyeAPI verisi (0-100)",
        "commercial_activity_score": "TKGM iÅŸlem trendi (0-100)",
        "weights": {
          "demographic": 0.6,
          "commercial": 0.4
        },
        "final_score": "(demographic * 0.6) + (commercial * 0.4)"
      },
      "example": {
        "bodrum_yalikavak": {
          "demographic": 100,
          "commercial": 95,
          "final": "(100 * 0.6) + (95 * 0.4) = 98/100"
        }
      }
    }
  },

  "implementation_plan": {
    "phase_7": {
      "name": "TKGM API Integration",
      "duration": "2-3 days",
      "priority": "high",
      "depends_on": "FAZ 1-6 (TurkiyeAPI) completed",
      "tasks": [
        "Create TKGMService.php",
        "Implement transaction frequency methods",
        "Cache strategy (yearly data)",
        "Create transaction heatmap widget",
        "Integrate with investment score calculation",
        "Add trend indicators to ilan detail page",
        "Create dashboard analytics",
        "AI prompt enhancement with trend data"
      ],
      "files_to_create": [
        "app/Services/TKGMService.php",
        "resources/views/components/ilan/transaction-trend.blade.php",
        "database/migrations/2025_10_24_create_tkgm_cache_table.php"
      ],
      "files_to_update": [
        "app/Services/TurkiyeAPIService.php (add combined score)",
        "resources/views/admin/ilanlar/show.blade.php",
        "app/Services/AIService.php"
      ]
    }
  },

  "technical_architecture": {
    "service_class": "TKGMService",
    "methods": [
      "getProvinces()",
      "getTransactionsByProvince($ilId, $year)",
      "getTransactionsByDistrict($ilId, $ilceId, $year)",
      "getTransactionTrend($ilId, $startYear, $endYear)",
      "calculateGrowthRate($year1, $year2)",
      "isHotspot($ilId, $threshold = 20)",
      "getNearbyTransactions($lat, $lon, $radius_km = 2.5)"
    ],
    "cache_strategy": {
      "duration": "1 year (historical data doesn't change)",
      "keys": "tkgm_transactions_{il_id}_{year}",
      "warming": "Load last 5 years on startup"
    },
    "fallback": {
      "primary": "TKGM API",
      "secondary": "Empty array (not critical, optional data)",
      "error_handling": "Log warning, continue without transaction data"
    }
  },

  "data_structure": {
    "tkgm_transactions": {
      "table": "tkgm_transactions_cache",
      "columns": {
        "id": "bigint primary key",
        "il_id": "int",
        "ilce_id": "int nullable",
        "year": "int",
        "parsel": "string",
        "lat": "decimal(10,8)",
        "lon": "decimal(11,8)",
        "count": "int (iÅŸlem sayÄ±sÄ±)",
        "created_at": "timestamp"
      },
      "indexes": ["il_id, year", "ilce_id, year", "lat, lon (spatial index)"]
    }
  },

  "combined_investment_score": {
    "formula": {
      "demographic_score": {
        "source": "TurkiyeAPI",
        "weight": 0.6,
        "factors": [
          "isCoastal (+30)",
          "isMetropolitan (+25)",
          "population > 500K (+20)",
          "district_population > 100K (+15)",
          "Aegean/Mediterranean (+10)"
        ]
      },
      "commercial_activity_score": {
        "source": "TKGM API",
        "weight": 0.4,
        "factors": [
          "3-year growth > 30% (+40)",
          "3-year growth 15-30% (+30)",
          "3-year growth 5-15% (+20)",
          "Stable 0-5% (+10)",
          "High transaction volume (+30)",
          "Recent year spike (+30)"
        ]
      },
      "final_calculation": "(demographic * 0.6) + (commercial * 0.4)"
    },
    "interpretation": {
      "95_to_100": "â­â­â­ Ultra YÃ¼ksek Potansiyel (Hem demografik hem ticari gÃ¼Ã§lÃ¼)",
      "85_to_94": "â­â­â­ YÃ¼ksek Potansiyel",
      "70_to_84": "â­â­ Orta Potansiyel",
      "0_to_69": "â­ GeliÅŸmekte"
    }
  },

  "visualization": {
    "heatmap": {
      "library": "Leaflet.js (already integrated)",
      "data": "TKGM transaction lat/lon points",
      "color_scale": "Blue (low) â†’ Red (high)",
      "tooltip": "Parsel: 123/456, Ä°ÅŸlem: 5 adet (2023)"
    },
    "trend_chart": {
      "library": "Chart.js",
      "type": "Line chart",
      "x_axis": "Years (2020-2024)",
      "y_axis": "Transaction count",
      "example": "2020: 245, 2021: 267, 2022: 289, 2023: 324 (+32% total)"
    }
  },

  "yalihan_bekci_rules": {
    "rule_31": "Always combine TurkiyeAPI (demographic) + TKGM (commercial) for full investment score",
    "rule_32": "Always show transaction trend (3 years minimum) on ilan detail page",
    "rule_33": "Always mark hotspot areas (>20% growth in 3 years) with ğŸ”¥ badge",
    "rule_34": "Always cache TKGM data for 1 year (historical data doesn't change)",
    "rule_35": "Always calculate growth rate percentage and show trend arrow (â†—ï¸ â†˜ï¸ â†’)"
  },

  "context7_compliance": {
    "naming": {
      "service": "TKGMService",
      "cache_keys": "tkgm_*",
      "table": "tkgm_transactions_cache"
    },
    "display": {
      "iÅŸlem_sayÄ±sÄ±": "Transaction Count",
      "trend": "Trend (â†—ï¸ Artan, â†˜ï¸ Azalan, â†’ Sabit)",
      "bÃ¼yÃ¼me_oranÄ±": "Growth Rate (%)"
    }
  },

  "success_metrics": {
    "technical": {
      "api_response_time": "< 1s",
      "cache_hit_rate": "> 90%",
      "data_accuracy": "100% (direct from TKGM)"
    },
    "business": {
      "investment_score_accuracy": "+25% (with commercial data)",
      "user_confidence": "+40% (seeing real transaction trends)",
      "conversion_rate": "+15% (hotspot badges work!)"
    }
  },

  "example_output": {
    "bodrum_yalikavak": {
      "location": "Bodrum, YalÄ±kavak, MuÄŸla",
      "turkiye_api_data": {
        "il_nufus": 1066736,
        "ilce_nufus": 198335,
        "yogunluk": "305 kiÅŸi/kmÂ²",
        "kiyi_ili": true,
        "buyuksehir": true,
        "demographic_score": 100
      },
      "tkgm_data": {
        "2021": 245,
        "2022": 289,
        "2023": 324,
        "3_year_growth": "+32%",
        "trend": "â†—ï¸ Artan",
        "hotspot": true,
        "commercial_score": 95
      },
      "combined": {
        "final_score": 98,
        "rating": "â­â­â­ Ultra YÃ¼ksek Potansiyel",
        "badges": ["ğŸŒŠ KÄ±yÄ± Ä°li", "ğŸ™ï¸ BÃ¼yÃ¼kÅŸehir", "ğŸ”¥ Hotspot BÃ¶lge", "ğŸ“ˆ %32 BÃ¼yÃ¼me"]
      }
    }
  },

  "next_steps": {
    "immediate": "Complete FAZ 1-6 (TurkiyeAPI) first",
    "then": "Implement FAZ 7 (TKGM) for commercial activity data",
    "timeline": "After 2 weeks (TurkiyeAPI complete)"
  }
}
