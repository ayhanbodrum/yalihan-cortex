{
  "timestamp": "2025-10-24T00:20:00Z",
  "task": "TKGM API AraÅŸtÄ±rmasÄ± - Tam Rapor",
  "status": "researched",
  "priority": "medium",
  "category": "api_research",

  "tkgm_apis": {
    "api_1": {
      "name": "MEGSÄ°S Web API v3",
      "base_url": "https://cbsapi.tkgm.gov.tr/megsiswebapi.v3/api",
      "endpoints_tested": [
        {
          "endpoint": "/parsel/{coordinates}",
          "example": "https://cbsapi.tkgm.gov.tr/megsiswebapi.v3/api/parsel/28.36667,37.21667",
          "status": "âŒ NOT FOUND",
          "error": "No HTTP resource was found",
          "reason": "Endpoint doÄŸru deÄŸil veya artÄ±k kullanÄ±lmÄ±yor"
        }
      ],
      "authentication": "Unknown",
      "terms": "TKGM izni gerekli"
    },

    "api_2": {
      "name": "CBS Servis API",
      "base_url": "https://cbsservis.tkgm.gov.tr/megsiswebapi.v3/api",
      "endpoints_working": [
        {
          "endpoint": "/idariYapi/ilListe",
          "url": "https://cbsservis.tkgm.gov.tr/megsiswebapi.v3/api/idariYapi/ilListe",
          "status": "âœ… WORKING",
          "response": "81 il listesi + id + geometri",
          "authentication": "None (public)"
        },
        {
          "endpoint": "/analiz?AnalizTip=2&Yil={year}&IlId={id}",
          "url": "https://cbsservis.tkgm.gov.tr/megsiswebapi.v3/api/analiz?AnalizTip=2&Yil=2023&IlId=48",
          "status": "âœ… WORKING",
          "response": "AlÄ±m-satÄ±m yoÄŸunluÄŸu (parsel, enlem, boylam, adet)",
          "authentication": "None (public)",
          "source": "https://medium.com/tapu-com-bakÄ±ÅŸ-aÃ§Ä±sÄ±/tapu-ve-kadastro-analiz-verilerinin-kullanÄ±mÄ±-32bd788a5ce9"
        }
      ],
      "authentication": "None (public API)",
      "rate_limit": "Unknown"
    },

    "api_3": {
      "name": "TKGM WMS (Web Map Service)",
      "base_url": "http://cbsservis.tkgm.gov.tr/tkgm.ows/wms",
      "protocol": "OGC WMS 1.1.1",
      "endpoints": [
        {
          "request": "GetCapabilities",
          "url": "http://cbsservis.tkgm.gov.tr/tkgm.ows/wms?service=WMS&version=1.1.1&request=GetCapabilities",
          "status": "âŒ AUTH REQUIRED",
          "error": "ERR_INVALID_AUTH_CREDENTIALS",
          "reason": "Kimlik doÄŸrulama gerekli"
        }
      ],
      "authentication": "âœ… REQUIRED (TKGM izni)",
      "use_case": "Harita katmanlarÄ± (parsel sÄ±nÄ±rlarÄ±, kadastro)"
    },

    "api_4": {
      "name": "Parsel Sorgu Web Sitesi",
      "url": "https://parselsorgu.tkgm.gov.tr",
      "type": "Web Interface (not API)",
      "features": [
        "Parsel sorgulama (ada, parsel)",
        "Koordinat bazlÄ± sorgulama",
        "AlÄ±m-satÄ±m yoÄŸunluÄŸu haritasÄ±",
        "Ä°mar durumu bilgisi"
      ],
      "api_available": "âŒ No public API",
      "scraping": "âš ï¸ MÃ¼mkÃ¼n ama yasal deÄŸil (TKGM TOS)"
    }
  },

  "working_apis_summary": {
    "free_and_working": [
      {
        "name": "Ä°l Listesi",
        "endpoint": "GET /idariYapi/ilListe",
        "data": "81 il + id + geometri",
        "use_case": "Ä°l dropdown populate"
      },
      {
        "name": "AlÄ±m-SatÄ±m YoÄŸunluÄŸu",
        "endpoint": "GET /analiz?AnalizTip=2&Yil={year}&IlId={id}",
        "data": "Parsel bazlÄ± iÅŸlem sayÄ±sÄ± (lat, lon, count)",
        "use_case": "Hotspot analizi, trend gÃ¶sterimi"
      }
    ],
    "requires_auth": [
      {
        "name": "WMS Harita Servisi",
        "endpoint": "WMS GetCapabilities",
        "data": "Kadastro harita katmanlarÄ±",
        "use_case": "Parsel sÄ±nÄ±rlarÄ± gÃ¶sterimi"
      },
      {
        "name": "Parsel Detay Sorgulama",
        "endpoint": "Unknown (not public)",
        "data": "Ada, parsel, malik, imar durumu",
        "use_case": "Tam parsel bilgisi"
      }
    ]
  },

  "recommendations": {
    "immediate_use": {
      "api": "CBS Servis API (AlÄ±m-SatÄ±m YoÄŸunluÄŸu)",
      "reason": "Free, working, no auth",
      "implementation": "FAZ 7: TKGM API Integration",
      "priority": "High",
      "value": "Hotspot detection, investment trend analysis"
    },

    "future_consideration": {
      "api": "TKGM WMS",
      "reason": "Requires official permission",
      "steps": [
        "Contact TKGM for API access",
        "Get authentication credentials",
        "Implement WMS layer display"
      ],
      "priority": "Low",
      "value": "Display cadastral boundaries on map"
    },

    "not_recommended": {
      "method": "Web scraping parselsorgu.tkgm.gov.tr",
      "reason": [
        "Against TKGM Terms of Service",
        "Legal risks",
        "Unreliable (site structure changes)",
        "Rate limiting issues"
      ],
      "alternative": "Use working public APIs only"
    }
  },

  "implementation_plan": {
    "phase_1_6": {
      "name": "TurkiyeAPI (Demografik)",
      "apis": ["TurkiyeAPI only"],
      "timeline": "10 days (current plan)"
    },

    "phase_7": {
      "name": "TKGM Integration (AlÄ±m-SatÄ±m)",
      "apis": ["CBS Servis API /analiz"],
      "timeline": "2-3 days",
      "features": [
        "Transaction trend by province",
        "Hotspot detection",
        "Growth rate calculation",
        "Heatmap visualization"
      ],
      "priority": "After Phase 1-6"
    },

    "phase_future": {
      "name": "WMS Integration (if approved)",
      "apis": ["TKGM WMS"],
      "timeline": "TBD (after getting permission)",
      "features": ["Cadastral boundary display", "Parcel overlay on map"],
      "priority": "Low (requires official approval)"
    }
  },

  "legal_considerations": {
    "public_apis": {
      "il_listesi": "âœ… Public, free to use",
      "analiz_api": "âœ… Public, free to use (for informational purposes)",
      "terms": "Bilgilendirme amaÃ§lÄ±dÄ±r, resmi iÅŸlemlerde kullanÄ±lamaz"
    },
    "restricted_apis": {
      "wms": "âš ï¸ Requires TKGM authorization",
      "parsel_detail": "âš ï¸ Not publicly available",
      "terms": "Ä°zin almadan kullanÄ±m hukuki sorumluluk doÄŸurur"
    },
    "recommendation": "Use only public APIs (ilListe, analiz). Contact TKGM for advanced features."
  },

  "technical_details": {
    "working_api_example": {
      "request": {
        "method": "GET",
        "url": "https://cbsservis.tkgm.gov.tr/megsiswebapi.v3/api/analiz",
        "params": {
          "AnalizTip": 2,
          "Yil": 2023,
          "IlId": 48
        }
      },
      "response": [
        {
          "parsel": "123/456",
          "enlem": 37.21667,
          "boylam": 28.36667,
          "sayÄ±": 5,
          "YÄ±l": 2023
        }
      ],
      "use_in_yalihan_emlak": {
        "feature": "Ä°lan Detay - AlÄ±m-SatÄ±m Trendi",
        "display": "Son 3 yÄ±lda bu bÃ¶lgede 324 iÅŸlem yapÄ±ldÄ± (+32% artÄ±ÅŸ)",
        "badge": "ğŸ”¥ Hotspot BÃ¶lge"
      }
    }
  },

  "comparison_with_turkiye_api": {
    "turkiye_api": {
      "provides": [
        "NÃ¼fus (1,066,736)",
        "YÃ¼zÃ¶lÃ§Ã¼mÃ¼ (12,654 kmÂ²)",
        "YoÄŸunluk (84 kiÅŸi/kmÂ²)",
        "BÃ¶lge (Ege)",
        "KÄ±yÄ±/BÃ¼yÃ¼kÅŸehir (true/true)"
      ],
      "value": "Demografik analiz, yatÄ±rÄ±m potansiyeli skoru"
    },
    "tkgm_api": {
      "provides": [
        "AlÄ±m-satÄ±m iÅŸlem sayÄ±sÄ± (324 adet)",
        "YÄ±llara gÃ¶re trend (+12% artÄ±ÅŸ)",
        "Parsel bazlÄ± koordinatlar",
        "Hotspot belirleme"
      ],
      "value": "Ticari aktivite analizi, pazar trendi"
    },
    "combined_value": {
      "turkiye_api_score": "100/100 (demografik)",
      "tkgm_score": "95/100 (ticari)",
      "final_score": "98/100 (kombinasyon)",
      "interpretation": "â­â­â­ Ultra YÃ¼ksek Potansiyel"
    }
  },

  "next_steps": {
    "immediate": {
      "step_1": "Complete FAZ 1-6 (TurkiyeAPI)",
      "step_2": "Implement FAZ 7 (TKGM Analiz API)",
      "timeline": "2 weeks total"
    },
    "future": {
      "step_1": "Contact TKGM for WMS access",
      "step_2": "Evaluate cost/benefit of advanced features",
      "step_3": "Implement if approved",
      "timeline": "TBD"
    }
  },

  "yalihan_bekci_rules": {
    "rule_36": "Only use public TKGM APIs (ilListe, analiz). Never scrape parselsorgu.tkgm.gov.tr",
    "rule_37": "Always add disclaimer: 'Bilgilendirme amaÃ§lÄ±dÄ±r, resmi iÅŸlemlerde kullanÄ±lamaz'",
    "rule_38": "If WMS access needed, contact TKGM officially (do not attempt unauthorized access)",
    "rule_39": "Cache TKGM transaction data for 1 year (historical data doesn't change)",
    "rule_40": "Combine TurkiyeAPI (60%) + TKGM (40%) for final investment score"
  }
}
