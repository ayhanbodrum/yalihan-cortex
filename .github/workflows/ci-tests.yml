name: CI Tests

on:
  push:
    branches: ["**"]
  pull_request:
    branches: ["**"]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '18'
      - name: Install
        run: npm install
      - name: Run unit tests
        run: npm test -s
      - name: Run A11Y checks
        run: npx vitest run --environment jsdom resources/js/__tests__/a11y.test.js -s
      - name: Run MCP latest (if secret present)
        env:
          CONTEXT7_API_KEY: ${{ secrets.CONTEXT7_API_KEY }}
        run: |
          if [ -n "$CONTEXT7_API_KEY" ]; then
            npm run mcp:latest || true
          else
            echo "CONTEXT7_API_KEY missing, skipping MCP"
          fi
      - name: Owner Private Audit Summary
        run: php artisan report:owner-private-audit || true
